# Домашнее задание к занятию «Микросервисы: подходы»

## Задача 1: Обеспечить разработку
Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.
Обоснуйте свой выбор.

## Решение
Для решения поставленных задач можно использовать GitLab.
1. **Для хранения кода использовать:** *GitLab*.\
   Соответствует требованию: Облачная система, Git, репозиторий на каждый сервис.
2. **Для CI/CD:**  *GitLab CI/CD + GitLab Runner на Kubernetes*.\
   Соответствие требованию: Запуск сборки по событию/по кнопке, настройки на сборку, шаблоны, кастомные шаги, свои Docker-образы, свои серверы для агентов, параллельные сборки и тесты.
3. **Безопасное хранение секретов:** *GitLab Variables + HashiCorp Vault*.\
   Соответствие требованию: Безопасное хранение паролей, ключей доступа.
   Некритичные секреты хранить в GitLab Variables, критичные - в Vault.

**Представляется такая схема взаимодействия:**
1. Разработчик пушит код в свой репозиторий в GitLab.
2. GitLab, на основе правил в .gitlab-ci.yml, запускает пайплайн.
3. GitLab CI/CD планировщик ищет доступный Runner.
4. Найденный Runner (установленный в Kubernetes) получает задание и создает для его выполнения временный Pod.
5. При необходимости Pod забирает актуальные секреты из GitLab Variables или Vault.
6. Pod скачивает указанный в job Docker-образ для сборки.
7. Pod выполняет все шаги, описанные в job.
8. По завершении Runner сообщает статус обратно в GitLab.
9. GitLab обновляет статус пайплайна и выводит логи в интерфейсе.

## Задача 2: Логи
Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.
Обоснуйте свой выбор.

## Решение
Для решения поставленной задачи можно использовать cтек ELK. Дополнительно для буферизации и гарантированной доставки можно использовать Apache Kafka.

Компоненты решения:
1. **Сбор логов с хостов:** *Filebeat*.\
Соответствие требованию: сбор логов в центральное хранилище со всех хостов, минимальные требования к приложениям, сбор логов из stdout.
3. **Гарантированная доставка/буферизация:** *Apache Kafka*.\
Соответствие требованию: гарантированная доставка логов до центрального хранилища.
3. **Обработка и преобразование логов:** *Logstash*.\
Соответствие требованию: обеспечение поиска и фильтрации по записям логов.
5. **Хранение и индексация:** *Elasticsearch*.\
Соответствие требованию: обеспечение поиска и фильтрации по записям логов.
5. **Web интерфейс:** *Kibana*.\
Соответствие требованию: обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов,возможность дать ссылку на сохранённый поиск по записям логов.

## Задача 3: Мониторинг
Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.
Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.
Обоснуйте свой выбор.

## Решение
